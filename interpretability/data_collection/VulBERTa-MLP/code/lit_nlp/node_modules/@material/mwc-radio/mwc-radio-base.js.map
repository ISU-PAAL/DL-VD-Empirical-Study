{"version":3,"file":"mwc-radio-base.js","sourceRoot":"","sources":["src/mwc-radio-base.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n@license\nCopyright 2018 Google Inc. All Rights Reserved.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport {addHasRemoveClass, FormElement, HTMLElementWithRipple} from '@material/mwc-base/form-element.js';\nimport {observer} from '@material/mwc-base/observer.js';\nimport {ripple} from '@material/mwc-ripple/ripple-directive.js';\nimport {MDCRadioAdapter} from '@material/radio/adapter.js';\nimport MDCRadioFoundation from '@material/radio/foundation.js';\nimport {html, property, query} from 'lit-element';\n\n/**\n * @fires checked\n */\nexport class RadioBase extends FormElement {\n  @query('.mdc-radio') protected mdcRoot!: HTMLElement;\n\n  @query('input') protected formElement!: HTMLInputElement;\n\n  @query('.mdc-radio__ripple') protected rippleElement!: HTMLElementWithRipple;\n\n  private _checked = false;\n\n  @property({type: Boolean}) global = false;\n\n  @property({type: Boolean, reflect: true})\n  get checked() {\n    return this._checked;\n  }\n\n  /**\n   * We define our own getter/setter for `checked` because we need to track\n   * changes to it synchronously.\n   *\n   * The order in which the `checked` property is set across radio buttons\n   * within the same group is very important. However, we can't rely on\n   * UpdatingElement's `updated` callback to observe these changes (which is\n   * also what the `@observer` decorator uses), because it batches changes to\n   * all properties.\n   *\n   * Consider:\n   *\n   *   radio1.disabled = true;\n   *   radio2.checked = true;\n   *   radio1.checked = true;\n   *\n   * In this case we'd first see all changes for radio1, and then for radio2,\n   * and we couldn't tell that radio1 was the most recently checked.\n   */\n  set checked(checked: boolean) {\n    const oldValue = this._checked;\n    if (!!checked === !!oldValue) {\n      return;\n    }\n    this._checked = checked;\n    if (this.formElement) {\n      this.formElement.checked = checked;\n    }\n    if (this._selectionController !== undefined) {\n      this._selectionController.update(this);\n    }\n    this.requestUpdate('checked', oldValue);\n\n    // useful when unchecks self and wrapping element needs to synchronize\n    this.dispatchEvent(new Event('checked', {bubbles: true, composed: true}));\n  }\n\n  @property({type: Boolean})\n  @observer(function(this: RadioBase, disabled: boolean) {\n    this.mdcFoundation.setDisabled(disabled);\n  })\n  disabled = false;\n\n  @property({type: String})\n  @observer(function(this: RadioBase, value: string) {\n    this._handleUpdatedValue(value);\n  })\n  value = '';\n\n  _handleUpdatedValue(newValue: string) {\n    // the observer function can't access protected fields (according to\n    // closure compiler) because it's not a method on the class, so we need this\n    // wrapper.\n    this.formElement.value = newValue;\n  }\n\n  @property({type: String}) name = '';\n\n  protected mdcFoundationClass = MDCRadioFoundation;\n\n  protected mdcFoundation!: MDCRadioFoundation;\n\n  private _selectionController?: SelectionController;\n\n  connectedCallback() {\n    super.connectedCallback();\n    // Note that we must defer creating the selection controller until the\n    // element has connected, because selection controllers are keyed by the\n    // radio's shadow root. For example, if we're stamping in a lit-html map\n    // or repeat, then we'll be constructed before we're added to a root node.\n    //\n    // Also note if we aren't using native shadow DOM, then we don't technically\n    // need a SelectionController, because our inputs will share document-scoped\n    // native selection groups. However, it simplifies implementation and\n    // testing to use one in all cases. In particular, it means we correctly\n    // manage groups before the first update stamps the native input.\n    //\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    this._selectionController = SelectionController.getController(this);\n    this._selectionController.register(this);\n    // With native <input type=\"radio\">, when a checked radio is added to the\n    // root, then it wins. Immediately update to emulate this behavior.\n    this._selectionController.update(this);\n  }\n\n  disconnectedCallback() {\n    // The controller is initialized in connectedCallback, so if we are in\n    // disconnectedCallback then it must be initialized.\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    this._selectionController!.unregister(this);\n    this._selectionController = undefined;\n  }\n\n  focusNative() {\n    this.formElement.focus();\n  }\n\n  get ripple() {\n    return this.rippleElement.ripple;\n  }\n\n  protected createAdapter(): MDCRadioAdapter {\n    return {\n      ...addHasRemoveClass(this.mdcRoot),\n      setNativeControlDisabled: (disabled: boolean) => {\n        this.formElement.disabled = disabled;\n      },\n    };\n  }\n\n  private _changeHandler() {\n    this.checked = this.formElement.checked;\n  }\n\n  private _focusHandler() {\n    if (this._selectionController !== undefined) {\n      this._selectionController.focus(this);\n    }\n  }\n\n  private _clickHandler() {\n    // Firefox has weird behavior with radios if they are not focused\n    this.formElement.focus();\n  }\n\n  protected render() {\n    return html`\n      <div class=\"mdc-radio\" .ripple=${ripple()}>\n        <input\n          class=\"mdc-radio__native-control\"\n          type=\"radio\"\n          name=\"${this.name}\"\n          .checked=\"${this.checked}\"\n          .value=\"${this.value}\"\n          @change=\"${this._changeHandler}\"\n          @focus=\"${this._focusHandler}\"\n          @click=\"${this._clickHandler}\">\n        <div class=\"mdc-radio__background\">\n          <div class=\"mdc-radio__outer-circle\"></div>\n          <div class=\"mdc-radio__inner-circle\"></div>\n        </div>\n        <div class=\"mdc-radio__ripple\"></div>\n      </div>`;\n  }\n\n  protected firstUpdated() {\n    super.firstUpdated();\n    // We might not have been able to synchronize this from the checked setter\n    // earlier, if checked was set before the input was stamped.\n    this.formElement.checked = this.checked;\n    if (this._selectionController !== undefined) {\n      this._selectionController.update(this);\n    }\n  }\n}\n\n/**\n * Unique symbol for marking roots\n */\nconst selectionController = Symbol('selection controller');\n\nclass SelectionSet {\n  selected: RadioBase|null = null;\n  ordered: RadioBase[]|null = null;\n  readonly set = new Set<RadioBase>();\n}\n\n/**\n * Only one <input type=\"radio\" name=\"group\"> per group name can be checked at\n * once. However, the scope of \"name\" is the document/shadow root, so built-in\n * de-selection does not occur when two radio buttons are in different shadow\n * roots. This class bridges the checked state of radio buttons with the same\n * group name across different shadow roots.\n */\nexport class SelectionController {\n  private sets: {[name: string]: SelectionSet} = {};\n\n  private focusedSet: SelectionSet|null = null;\n\n  private mouseIsDown = false;\n\n  private updating = false;\n\n  static getController(element: HTMLElement|HTMLElement&{global: boolean}) {\n    const useGlobal =\n        !('global' in element) || ('global' in element && element.global);\n    const root = useGlobal ?\n        document as Document & {[selectionController]?: SelectionController} :\n        element.getRootNode() as Node &\n            {[selectionController]?: SelectionController};\n    let controller = root[selectionController];\n    if (controller === undefined) {\n      controller = new SelectionController(root);\n      root[selectionController] = controller;\n    }\n    return controller;\n  }\n\n  constructor(element: Node) {\n    element.addEventListener(\n        'keydown', (e: Event) => this.keyDownHandler(e as KeyboardEvent));\n    element.addEventListener('mousedown', () => this.mousedownHandler());\n    element.addEventListener('mouseup', () => this.mouseupHandler());\n  }\n\n  protected keyDownHandler(e: KeyboardEvent) {\n    if (!(e.target instanceof RadioBase)) {\n      return;\n    }\n    const element = e.target;\n    if (!this.has(element)) {\n      return;\n    }\n    if (e.key == 'ArrowRight' || e.key == 'ArrowDown') {\n      this.next(element);\n    } else if (e.key == 'ArrowLeft' || e.key == 'ArrowUp') {\n      this.previous(element);\n    }\n  }\n\n  protected mousedownHandler() {\n    this.mouseIsDown = true;\n  }\n\n  protected mouseupHandler() {\n    this.mouseIsDown = false;\n  }\n\n  has(element: RadioBase) {\n    const set = this.getSet(element.name);\n    return set.set.has(element);\n  }\n\n  previous(element: RadioBase) {\n    const order = this.getOrdered(element);\n    const i = order.indexOf(element);\n    this.select(order[i - 1] || order[order.length - 1]);\n  }\n\n  next(element: RadioBase) {\n    const order = this.getOrdered(element);\n    const i = order.indexOf(element);\n    this.select(order[i + 1] || order[0]);\n  }\n\n  select(element: RadioBase) {\n    element.click();\n  }\n\n  /**\n   * Helps to track the focused selection group and if it changes, focuses\n   * the selected item in the group. This matches native radio button behavior.\n   */\n  focus(element: RadioBase) {\n    // Only manage focus state when using keyboard\n    if (this.mouseIsDown) {\n      return;\n    }\n    const set = this.getSet(element.name);\n    const currentFocusedSet = this.focusedSet;\n    this.focusedSet = set;\n    if (currentFocusedSet != set && set.selected && set.selected != element) {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      set.selected!.focusNative();\n    }\n  }\n\n  getOrdered(element: RadioBase) {\n    const set = this.getSet(element.name);\n    if (!set.ordered) {\n      set.ordered = Array.from(set.set);\n      set.ordered.sort(\n          (a, b) =>\n              a.compareDocumentPosition(b) == Node.DOCUMENT_POSITION_PRECEDING ?\n              1 :\n              0);\n    }\n    return set.ordered;\n  }\n\n  getSet(name: string) {\n    if (!this.sets[name]) {\n      this.sets[name] = new SelectionSet();\n    }\n    return this.sets[name];\n  }\n\n  register(element: RadioBase) {\n    const set = this.getSet(element.name);\n    set.set.add(element);\n    set.ordered = null;\n  }\n\n  unregister(element: RadioBase) {\n    const set = this.getSet(element.name);\n    set.set.delete(element);\n    set.ordered = null;\n    if (set.selected == element) {\n      set.selected = null;\n    }\n  }\n\n  update(element: RadioBase) {\n    if (this.updating) {\n      return;\n    }\n    this.updating = true;\n    if (element.checked) {\n      const set = this.getSet(element.name);\n      for (const e of set.set) {\n        e.checked = (e == element);\n      }\n      set.selected = element;\n    }\n    this.updating = false;\n  }\n}\n"]}